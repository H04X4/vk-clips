# Руководство по настройке `config.py`

Этот файл содержит инструкции по настройке файла `config.py`, используемого в боте для автоматической загрузки и публикации видео в VK Clips через Telegram-интерфейс. Ниже описаны все параметры, их назначение и способы получения необходимых значений.

---

## Структура `config.py`

Файл `config.py` содержит следующие параметры:

### VK

```python
ACCESS_TOKEN = "your_vk_access_token"  # Токен доступа для VK API
API_VERSION = "5.249"                  # Версия VK API
PROCESSING_DELAY = 40                  # Секунды ожидания между загрузкой и публикацией видео
```

### Telegram

```python
TELEGRAM_TOKEN = "your_telegram_bot_token"  # Токен Telegram-бота
ADMIN_CHAT_ID = 123456789                   # ID чата администратора (или None для доступа всем)
```

### Загрузка

```python
TOP_COUNT = 2                 # Количество видео из топа VK для обработки
VIDEOS_DIR = "videos"         # Локальная папка для временного хранения видео
MAX_LINES_IN_LOG = 1          # Количество строк лога в сообщениях Telegram
```

---

## Подробное описание параметров и где их взять

### Параметры VK

#### `ACCESS_TOKEN`

* **Описание**: Токен доступа для работы с VK API, необходимый для выполнения запросов, таких как получение топа видео, загрузка и публикация клипов.
* **Как получить**:

  1. Перейдите на [https://vkhost.github.io](https://vkhost.github.io)
  2. Авторизуйтесь и разрешите доступ.
  3. После редиректа найдите в URL `access_token=...` и скопируйте значение до `&`.
  4. Вставьте полученный токен в `ACCESS_TOKEN` в `config.py`.

#### `API_VERSION`

* **Описание**: Версия VK API, используемая ботом.
* **Рекомендация**: Оставьте `"5.249"`, так как это последняя стабильная версия на момент написания документации.
* **Примечание**: Изменение версии может повлиять на совместимость с методами API.

#### `PROCESSING_DELAY`

* **Описание**: Задержка в секундах между загрузкой видео и его редактированием/публикацией в VK Clips. Это нужно для обработки видео на серверах VK.
* **Значение по умолчанию**: `40` секунд.
* **Минимум**: `0`.
* **Авто-задержка**: рассчитывается как `3600 / TOP_COUNT`.

---

### Параметры Telegram

#### `TELEGRAM_TOKEN`

* **Описание**: Токен Telegram-бота для взаимодействия с Telegram API.
* **Как получить**:

  1. В Telegram найдите бота `@BotFather`.
  2. Напишите `/start`, затем `/newbot`.
  3. Укажите имя бота и username (username должен заканчиваться на `Bot`).
  4. Скопируйте полученный токен и вставьте в `TELEGRAM_TOKEN` в `config.py`.
* **Примечание**: Храните токен в безопасности, не публикуйте его публично.

#### `ADMIN_CHAT_ID`

* **Описание**: ID чата Telegram, которому разрешено использовать команды бота.
* **Как получить**:

  * ЛС: через `@userinfobot` → `/start`.
  * Группа: через `@GetChatIDBot` или API Telegram.
* **Если** указано `None`, доступ открыт всем.

---

### Параметры загрузки

#### `TOP_COUNT`

* **Описание**: Количество видео из топа VK для загрузки за цикл.
* **Рекомендация**: Начать с `2`. Минимум `1`.
* **Примечание**: Слишком большие значения могут вызвать ошибку `Flood control`.

#### `VIDEOS_DIR`

* **Описание**: Локальная папка для временного хранения видео.
* **Примечание**: Бот создаст папку, если её нет.

#### `MAX_LINES_IN_LOG`

* **Описание**: Количество строк лога в сообщениях Telegram.
* **Примечание**: Увеличение значения может привести к обрезанию сообщений в Telegram.

---

## Как использовать бота

1. **Установите зависимости**:

   ```bash
   pip install aiogram yt-dlp aiohttp
   ```
2. **Установите `ffmpeg`**:

   * Windows: скачать и добавить в PATH.
   * Linux/Mac: `sudo apt install ffmpeg` или `brew install ffmpeg`.
3. **Настройте `config.py`**:

   * Замените `ACCESS_TOKEN`, `TELEGRAM_TOKEN` и `ADMIN_CHAT_ID` на свои значения.
   * При необходимости измените `TOP_COUNT`, `PROCESSING_DELAY`, `VIDEOS_DIR`, `MAX_LINES_IN_LOG`.
4. **Запустите бота**:

   ```bash
   python telegram_bot.py
   ```
5. **Взаимодействие**:

   * `/start` для открытия меню настроек.
   * Кнопки для изменения `TOP_COUNT` и `PROCESSING_DELAY`.
   * `/run` или кнопка "Запостить ещё" для цикла загрузки.

---

## Важные замечания

* **Ограничения VK API**: при ошибке `Flood control` увеличьте `PROCESSING_DELAY` или включите авто-задержку.
* **Безопасность**: не публикуйте `ACCESS_TOKEN` и `TELEGRAM_TOKEN`.
* **Логирование**: ошибки отправляются в `ADMIN_CHAT_ID`.
* **Авто-задержка**: `3600 / TOP_COUNT` секунд.

---

## Пример `config.py`

```python
# VK
ACCESS_TOKEN = "vk1.a.-Lt8bekF1RjgFJlRO1Bhv9k6wQxWENiJOXsM_c_uQIGGyp7jjEIt2kmJol4RKBKwvZEODBAGIVg"
API_VERSION = "5.249"
PROCESSING_DELAY = 40

# Telegram
TELEGRAM_TOKEN = "8274120522:"
ADMIN_CHAT_ID = 110717040

# Загрузка
TOP_COUNT = 2
VIDEOS_DIR = "videos"
MAX_LINES_IN_LOG = 1
```

---

## Устранение неполадок

* **Ошибка `Flood control`**:

  * Увеличьте `PROCESSING_DELAY` или включите авто-задержку.
  * Подождите 5–10 минут перед перезапуском.
* **Ошибка доступа к VK API**:

  * Проверьте `ACCESS_TOKEN`, должны быть права `video,offline`.
* **Бот не отвечает**:

  * Проверьте `TELEGRAM_TOKEN` и доступность бота в чате.
* **Ошибка записи в `config.py`**:

  * Убедитесь, что есть права на запись в папку.

Если остались вопросы, обратитесь к документации VK API и Telegram Bot API.
